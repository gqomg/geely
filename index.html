<!doctype html>
<html>
<head>
<meta charset="utf-8">
<title>为《汽车密码》发声！</title>
<link rel="stylesheet" href="css/style.css">
<style>
.btnrecord {
			-webkit-touch-callout:none;
			-webkit-user-select:none;
			-khtml-user-select:none;
			-moz-user-select:none;
			-ms-user-select:none;
			user-select:none;
		}
</style>
<script>
		var phoneWidth =  parseInt(window.screen.width);
		var phoneScale = phoneWidth/640;
		var ua = navigator.userAgent;
		if (/Android (\d+\.\d+)/.test(ua)){
			var version = parseFloat(RegExp.$1);
			if(version>2.3){
				document.write('<meta name="viewport" content="width=640, minimum-scale = '+phoneScale+', maximum-scale = '+phoneScale+', target-densitydpi=device-dpi">');
			}else{
				document.write('<meta name="viewport" content="width=640, target-densitydpi=device-dpi">');
			}
		} else {
			document.write('<meta name="viewport" content="width=640, user-scalable=no, target-densitydpi=device-dpi">');
		}
</script>
<script src="js/jquery.min.js"></script>
<script src="js/TweenMax.min.js"></script>
 <script src="js/record.min.js"></script>
 <script src="js/ya-jssdk.js?s=2"></script>
<script  src="https://res.wx.qq.com/open/js/jweixin-1.1.0.js"></script>
<script src="http://nan3.zihx.com/resources/Scripts/weixinjssdk.js"></script>
<script src="js/bd.js?s=2"></script>
<script src="js/WxCommon.js"></script>
<script>
  var isWx;	  
  var mode = 2;
  var ua = window.navigator.userAgent.toLowerCase();
	if(ua.match(/MicroMessenger/i) == 'micromessenger'){
		isWx=true;
		mode=2;
	}else{
		isWx=false;
		mode=1;
	}
		
</script>
</head>
<body>
<audio style="height:0; display:none;" id="music" src="bg.mp3" autoplay loop  preload="auto" ></audio>

<div id="wrapper">
<div id="index" class="page ">
<img src="images/logo.png" style="position:absolute; left:192px; top:35px;">
<div class="vitch">
<div class="indextit"></div>
<div class="indexpic">
<img src="images/clound3.png" class="clound1">
<img src="images/clound2.png" class="clound2">
<img src="images/clound1.png" class="clound3">
</div>
</div>
<img src="images/btnindex.png" class="btnindex" onClick="$('#yulu').show();$('#index').hide()">
<img src="images/btnrule.png" class="btnrule" onClick="$('#rulepop,.bgblack').show()">
<div class="musicIcon"></div>
</div>

<div id="record" class="page none">
<div class="btnback" onClick="backyulu()"></div>
<div class="musicIcon"></div>
<p style="position:absolute; text-align:center; left:0; width:640px; text-align:center; color:#fff; font-size:30px; top:88px;">录制语录</p>
<div class="gecipic ">
<img src="images/yun.png" style="position:absolute; left:443px; top:30px;-webkit-animation: fd 2.2s infinite linear; ">
</div>
<div class="gecibox">
<span id="yuluNum">精彩语录一</span>
<p class="btnadd btngeci"></p>
    <div class="geci">
    <div style="padding-top:50px;">
    </div>
    </div>
</div>



<div class="progressbar">
<div style="left:-80px;">00:<span id="timeNumOrder">00</span></div>
<p class="progress"><span></span></p>
<div style="right:-80px;">00:<span id="timeNum">60</span></div>
</div>

<div class="btnscale"></div>
<div class="btnrecord"></div>

</div>

<div id="success" class="page none">
<div class="musicIcon"></div>
<div class="successpic">
<img src="images/i1.png" class="i_1">
<img src="images/i2.png" class="i_2">
<img src="images/i3.png" class="i_3">
<img src="images/i4.png" class="i_4">
<img src="images/i5.png" class="i_5">
<img src="images/i6.png" class="i_6">
</div>
<span class="back" onClick="backRecord()"></span>
<span class="btnplay" id="bofang"></span>
<span class="btnsub" onClick="subgc()"></span>
</div>

<div id="result" class="page none">
<img src="images/logo.png" style="position:absolute; left:192px; top:35px;">
<img  id="headpic">
<img src="images/clound.png" class="clound">
<p id="headname"></p>
<p id="randomNote" style="position:absolute; left:169px; top:677px; width:281px; color:#fff; font-size:24px; text-align:center;"></p>
<img src="images/yun2.png" style="position:absolute; left:393px; top:578px; -webkit-animation: hd 2.2s infinite linear;">
<img src="images/yun3.png" style="position:absolute; left:483px; top:641px; -webkit-animation: fd 2.2s infinite linear; -webkit-animation-delay:0.4s;">
<span class="canote"></span>
<img id="gimg" style=" position:absolute; width:346px; height:461px; left:140px; top:352px; opacity:0;">
<div id="playbtn" class="play"></div>
<a href="index.html" class="btnhome"></a>
<span class="btnshare" onClick="sharepop()"></span>
</div>


<div id="yulu" class="page none">
<div class="yulubg">
<div style="position:absolute; left:58px; top:141px; width:530px; overflow:hidden; height:516px;">
<ul class="yulu ">
<li onclick="checkYu(0,this)"><span>①</span>每到关键时刻，李书福总爱反向思考。和当初并购沃尔沃一样，当所有人认为吉利即将出局时，他反倒认为机会来了。<p class="cur none"></p>
</li>
<li onclick="checkYu(1,this)"><span>②</span>持有更多股份意味着对方愿意承担更大的投入与风险,这对我们而言是公平的,也说明合作伙伴不是要抛弃这家企业,而是真正想和吉利一同将宝腾路特斯做大,我们要成全合作伙伴。
<p class="cur none"></p>
</li>
<li onclick="checkYu(2,this)"><span>③</span>这或许就是伟大企业家身上的特质：没有章法可循，没有事先思考，灵机一动的判断总会将每一个商业行为升华。
<p class="cur none"></p>
</li>
<li onclick="checkYu(3,this)"><span>④</span>中国的本土职业经理人不同，他们每天都在生命线上挣扎，并逐渐摸索出一套应对跨国车企竞争的方法。  
<p class="cur none"></p>
</li>
<li onclick="checkYu(4,this)"><span>⑤</span>世界汽车工业最后发展方向就是模块化生产。就像小孩搭积木，同样的零部件通过不同的装配与设计，最后生产出不一样的汽车产品。这是汽车行业的一个规律，到那时，汽车制造就相当于电脑DIY一样，大家都可以自己组装，而且这一天不会很遥远。
<p class="cur none"></p>
</li>
</ul>
</div>
<div class="yuluarr"></div>
</div>
</div>



<div class="bgblack" style="display:none;"></div>
<div id="rulepop" style="display:none;">
<span onClick="$('#rulepop,.bgblack').hide()" style="position:absolute; display:block; width:68px; height:68px; right:0; top:0;"></span>
<span onClick="$('#rulepop,.bgblack').hide()" style="position:absolute; display:block; width:130px; height:62px; left:195px; top:500px;"></span>
</div>
<div class="alertpop">
<span onClick="$('.bgblack,.alertpop').hide()"></span>
</div>
<img src="images/sharepop.png" class="sharepop" style="position:absolute; left:0; top:0; z-index:10; display:none;">
</div>

 <div id="sharepopya" class="none" style="background:url(images/ya_sharepop.png) no-repeat 0 bottom; overflow:hidden; position:fixed; left:0; bottom:0; width:640px; height:1200px; z-index:10;">
	<a href="javascript:void(0)" onClick="setShareTop('weixinGroup')" style="position:absolute; display:block; width:121px; height:128px; bottom:140px; left:190px;"></a>
	<a href="javascript:void(0)" onClick="setShareTop('weixin')" style="position:absolute; display:block; width:121px; height:128px; bottom:140px; left:338px;"></a>
	<span style="position:absolute; display:block; width:640px; height:58px; left:0; bottom:0;" onClick="$('#sharepopya').hide()"></span>
</div>
<script>
var userInfo = api.getUserInfo(mode); 
$('#headpic').attr('src',userInfo.userimg);
$('#headname').text(userInfo.username); 
</script>
<script>
(function(a){a.fn.touchwipe=function(c){var b={min_move_x:20,min_move_y:20,wipeLeft:function(){},wipeRight:function(){},wipeUp:function(){},wipeDown:function(){},wipe:function(){},wipehold:function(){},preventDefaultEvents:true};if(c){a.extend(b,c)}this.each(function(){var h;var g;var j=false;var i=false;var e;function m(){this.removeEventListener("touchmove",d);h=null;j=false;clearTimeout(e)}function d(q){if(b.preventDefaultEvents){q.preventDefault()}if(j){var n=q.touches[0].pageX;var r=q.touches[0].pageY;var p=h-n;var o=g-r;if(Math.abs(p)>=b.min_move_x){m();if(p>0){b.wipeLeft()}else{b.wipeRight()}}else{if(Math.abs(o)>=b.min_move_y){m();if(o>0){b.wipeUp()}else{b.wipeDown()}}}}}function k(){clearTimeout(e);if(!i&&j){b.wipe()}i=false}function l(){i=true;b.wipehold()}function f(n){if(n.touches.length==1){h=n.touches[0].pageX;g=n.touches[0].pageY;j=true;this.addEventListener("touchmove",d,false);e=setTimeout(l,750)}}if("ontouchstart" in document.documentElement){this.addEventListener("touchstart",f,false);this.addEventListener("touchend",k,false)}});return this};})(jQuery);

window.addEventListener('touchmove', function(e){e.preventDefault()}, { passive: false });

var yl_id = 0, yl_lock=false;

$(".yulubg").touchwipe({
		wipeUp:function(){
			if(yl_id == 2 || yl_lock){
				return	
			}
			yl_lock = true
			yl_id++
			$('.yulu').animate({top:-516*yl_id},function(){
				yl_lock = false
				})
		},
		wipeDown:function(){
			if(yl_id == 0 || yl_lock){
				return	
			}
			yl_lock = true
			yl_id--
			$('.yulu').animate({top:-516*yl_id},function(){
				yl_lock = false
				})
		}
	})
var geciArr=['每到关键时刻，<br>李书福总爱反向思考。<br>和当初并购沃尔沃一样，<br>当所有人认为吉利即将出局时，<br>他反倒认为机会来了。',
'持有更多股份意味着<br>对方愿意承担更大的投入与风险,<br>这对我们而言是公平的,<br>也说明合作伙伴<br>不是要抛弃这家企业,<br>而是真正想和吉利<br>一同将宝腾路特斯做大,<br>我们要成全合作伙伴。',
'这或许就是伟大企业家<br>身上的特质：<br>没有章法可循，<br>没有事先思考，<br>灵机一动的判断<br>总会将每一个商业行为升华。',
'中国的本土职业经理人不同，<br>他们每天都在生命线上挣扎，<br>并逐渐摸索出<br>一套应对跨国车企竞争的方法。',
'世界汽车工业最后发展方向<br>就是模块化生产。<br>就像小孩搭积木，<br>同样的零部件<br>通过不同的装配与设计，<br>最后生产出不一样的汽车产品。<br>这是汽车行业的一个规律，<br>到那时，<br>汽车制造就相当于电脑DIY一样，<br>大家都可以自己组装，<br>而且这一天不会很遥远。'
]
var checklock=false;
function checkYu(i,obj){
	if(checklock){
		return
	}
	checklock=true
	$(obj).find('.cur').show()
	$('.btngeci').removeClass('btnplus').addClass('btnadd')
	$('.geci').css('height',0)
	$('.geci div').html(geciArr[i])
	if(i==0){
		$('#yuluNum').html('精彩语录一')	
	}else if(i==1){
		$('#yuluNum').html('精彩语录二')
	}else if(i==2){
		$('#yuluNum').html('精彩语录三')
	}else if(i==3){
		$('#yuluNum').html('精彩语录四')
	}else if(i==4){
		$('#yuluNum').html('精彩语录五')
	}
	setTimeout(function(){
		$('#yulu').hide();
		$('#record').show();
		setTimeout(function(){
			$('.geci').animate({height:532},1000)
			$('.gecipic').fadeOut(1000)
			$('.btngeci').removeClass('btnadd').addClass('btnplus')
			},1000)
	},500)
}	
function backyulu(){
	$('.yulu').find('.cur').hide();
	$('#yulu').show()
	$('#record').hide();
	checklock=false;
	$('.gecipic').show();
}

var hh = $(window).height()
$('.page,.bgblack').height(hh)
$('.vitch').css('top',(hh-900)/2)
$('#rulepop').css('top',(hh-624)/2)
$('.yulubg').css('top',(hh-834)/2)
$('.alertpop').css('top',(hh-144)/2)

$('.btngeci').click(function(){
	if($(this).hasClass('btnadd')){
		$('.gecipic').fadeOut(1000)
		$(this).removeClass('btnadd').addClass('btnplus')
		$('.geci').animate({height:532},1000)
	}else{
		$('.gecipic').fadeIn(1000)
		$(this).removeClass('btnplus').addClass('btnadd')
		$('.geci').animate({height:0},1000)
		}
})

function startRecord(){
	if(isWx){
		wx.startRecord();	
	}else{
		ya.recorder.startRecord(function () {});	
	}
}
function stopRecord(cb){
	if(isWx){
		wx.stopRecord({
			success:function (res) {
				cb(res)
			}
		})	
	}else{
		ya.recorder.pauseRecord(function (localId) {
			cb(localId)
		});	
	}
}

var timeNum=60
var inter=null;
var localId;
$('.btnrecord').bind('touchstart',function(){
	$('.btnscale').addClass('active')
	startRecord()
	inter = setInterval(function(){
		if(timeNum == 0){
			stopRecord(function(res){
				if(isWx){
					localId=res.localId
					}else{
					localId=res;
					}
				$('#record').hide()
				$('#success').show()
				setTimeout(function(){
					TweenMax.to($('.i_1'),1,{scale:1,opacity:1,ease:Elastic.easeOut,onComplete:function(){
						$('.i_1').addClass('i_active')
						}})	
					TweenMax.to($('.i_2'),1,{delay:0.2,scale:1,opacity:1,ease:Elastic.easeOut,onComplete:function(){
						$('.i_2').addClass('i_active')
						}})	
					TweenMax.to($('.i_3'),1,{delay:0.4,scale:1,opacity:1,ease:Elastic.easeOut,onComplete:function(){
						$('.i_3').addClass('i_active')
						}})	
					TweenMax.to($('.i_4'),1,{delay:0.6,scale:1,opacity:1,ease:Elastic.easeOut,onComplete:function(){
						$('.i_4').addClass('i_active')
						}})	
					TweenMax.to($('.i_5'),1,{delay:0.8,scale:1,opacity:1,ease:Elastic.easeOut,onComplete:function(){
						$('.i_5').addClass('i_active')
						}})
				},800)		
			})
			clearInterval(inter)
			}else{
			timeNum--;
			TweenMax.to($('.progress'),1,{width:(60-timeNum) * 390/60,ease:'linear'})
			}
		var numtxt = timeNum<10 ? '0'+timeNum : timeNum
		var numtxt_order = (60-timeNum)<10 ? '0'+(60-timeNum) : (60-timeNum)
		$('#timeNum').text(numtxt)	
		$('#timeNumOrder').text(numtxt_order)
	},1000)	
}).bind('touchend',function(){
	$('.btnscale').removeClass('active')
	clearInterval(inter)
	if(timeNum>=58){
		localId='';
		stopRecord(function(){
			$('.bgblack,.alertpop').show()
			timeNum=60
			$('#timeNum').text('60')
			$('#timeNumOrder').text('00')
			$('.progress').width(0)
		})
	}else{
		stopRecord(function(res){
			if(isWx){
				localId=res.localId
				}else{
				localId=res;
				}
			clearInterval(inter)
			setTimeout(function(){
				TweenMax.to($('.i_1'),1,{scale:1,opacity:1,ease:Elastic.easeOut,onComplete:function(){
						$('.i_1').addClass('i_active')
						}})	
					TweenMax.to($('.i_2'),1,{delay:0.2,scale:1,opacity:1,ease:Elastic.easeOut,onComplete:function(){
						$('.i_2').addClass('i_active')
						}})	
					TweenMax.to($('.i_3'),1,{delay:0.4,scale:1,opacity:1,ease:Elastic.easeOut,onComplete:function(){
						$('.i_3').addClass('i_active')
						}})	
					TweenMax.to($('.i_4'),1,{delay:0.6,scale:1,opacity:1,ease:Elastic.easeOut,onComplete:function(){
						$('.i_4').addClass('i_active')
						}})	
					TweenMax.to($('.i_5'),1,{delay:0.8,scale:1,opacity:1,ease:Elastic.easeOut,onComplete:function(){
						$('.i_5').addClass('i_active')
						}})
				},800)	
			$('#record').hide()
			$('#success').show()	
		})
	}	
})

function playRecord(){
	if(isWx){
		wx.playVoice({
			localId: localId
		});
	}else{
		ya.recorder.playVoice(function (localId) {});
	}
}
function pauseRecord(){
	if(isWx){
		wx.stopVoice({
			localId: localId
		});
	}else{
		ya.recorder.stopRecord(function (localId) {});
	}	
}
function endRecord(cb){
	if(isWx){
		wx.onVoicePlayEnd({
			success: function (res) {
				cb()
			}
		});
	}else{
		ya.recorder.bind({
			 onPlayEnd: function () {
				cb()
			}
		})
	}
}	
	
var isbgm=false	
$('#bofang').click(function(){
	if($(this).hasClass('btnpause')){
		$(this).removeClass('btnpause').addClass('btnplay')	
		pauseRecord()
	}else{
		//播放
		if(playing){
			myAudio.pause();
			$('.musicIcon').addClass('close')
			playing = !playing;
			isbgm=true
		}
		$(this).removeClass('btnplay').addClass('btnpause')
		playRecord()
		endRecord(function(){
			$('#bofang').removeClass('btnpause').addClass('btnplay')
			$('#playbtn').removeClass('pause').addClass('play')	
			if(isbgm){
				myAudio.play();
				$('.musicIcon').removeClass('close')
				playing = !playing;
			}
		})		
		}
})


		
		

function backRecord(){
	$('#success').hide()
	$('#record').show();
	timeNum=60
	$('#timeNum').text('60')
	$('#timeNumOrder').text('00')
	$('.progress').width(0)	
	TweenMax.set($('.i_1'),{scale:0.1,opacity:0})	
	TweenMax.set($('.i_2'),{scale:0.1,opacity:0})	
	TweenMax.set($('.i_3'),{scale:0.1,opacity:0})	
	TweenMax.set($('.i_4'),{scale:0.1,opacity:0})	
	TweenMax.set($('.i_5'),{scale:0.1,opacity:0})
	$('.i_1,.i_2,.i_3,.i_4,.i_5').removeClass('i_active')
}	
var worknote = ['为民族企业的国际范儿打call！','大视野有大智慧，听听我最喜欢的金句！','为远见鼓掌，为情怀发声']

var dataId;
function subgc(){
	pauseRecord()
	$('#bofang').removeClass('btnpause').addClass('btnplay')	
	if(isWx){
		 wx.uploadVoice({
            localId: localId, // 需要上传的音频的本地ID，由stopRecord接口获得
            isShowProgressTips: 1,// 默认为1，显示进度提示
            success: function (res) {
                var data = api.savevoice_wx(res.serverId);
               	if(data.code==1){	
					$('#result').show()
					$('#success').hide()
					$('#randomNote').text(worknote[Math.floor(Math.random()*3)])
					
					var res = api.generateImg_wx(data.Id)
					$('#gimg').attr('src',res.gimg)
					
					DATAForWeixin.setTimeLine({
						title: '站住！把你的声音交出来！',
						imgUrl: "http://geely.nan3.net/images/share.jpg",
						link: 'http://geely.nan3.net/page.html?id='+data.Id,
						desc: '站住！把你的声音交出来！',
						success: function () {
						}
					});
					//分享朋友设置
					DATAForWeixin.setAppMessage({
						title: '站住！把你的声音交出来！',
						imgUrl: "http://geely.nan3.net/images/share.jpg",
						desc: '为民族企业的国际范儿打call！',
						link: 'http://geely.nan3.net/page.html?id='+data.Id,
						success: function () {
						}
					});
				}
            }
        });	
	}else{
		ya.recorder.uploadVoice(localId, function (res) {
			var obj = JSON.parse(res);
			var jsonData = api.savevoice_ya(obj.data.url);
			if(jsonData.code==1){
				$('#randomNote').text(worknote[Math.floor(Math.random()*3)])
				$('#result').show()
				$('#success').hide()
				dataId=jsonData.Id
				var res = api.generateImg_ya(dataId)
				$('#gimg').attr('src',res.gimg)
			}
		})
	}
}


function setShareTop(obj) {
            var shareChannel = {
                'weixin': '微信',
                'weixinGroup': '微信朋友圈'
            };
            var type = 'link';
            var dataUrl = '';
			
			var stitle,sdesc,slink;
			if(obj == 'weixin'){
				stitle = '站住！把你的声音交出来！';
				sdesc = '为民族企业的国际范儿打call！';
				slink='http://geely.nan3.net/page.html?id='+dataId
				}
			if(obj == 'weixinGroup'){
				stitle = '站住！把你的声音交出来！';
				sdesc =  '站住！把你的声音交出来！';
				slink='http://geely.nan3.net/page.html?id='+dataId
				}
            ya.multiShare({
                channel: obj,
                title: stitle,
                desc: sdesc,
                link: slink,
                imgUrl: 'http://geely.nan3.net/images/share.jpg',
                type: type,
                dataUrl: dataUrl
            }, function (res) {
                // 成功
                if (res.ret == 0) {
					_hmt.push(['_trackEvent', 'ximalaya', 'share', obj, 1]);
                    alert(JSON.stringify('分享到【' + channel + '】成功！'));
                } else {
                    alert(res.msg);
                }
            });


 }	  




$('#playbtn').click(function(){
	if($(this).hasClass('play')){
		if(playing){
			myAudio.pause();
			$('.musicIcon').addClass('close')
			playing = !playing;
			isbgm=true
		}
		$(this).removeClass('play').addClass('pause')	
		playRecord()
		endRecord(function(){
			$('#bofang').removeClass('btnpause').addClass('btnplay')
			$('#playbtn').removeClass('pause').addClass('play')	
			if(isbgm){
				myAudio.play();
				$('.musicIcon').removeClass('close')
				playing = !playing;
			}
		})
	}else{
		$(this).removeClass('pause').addClass('play')
		pauseRecord()
		}
})	



function sharepop(){
	if(isWx){
		$('.bgblack,.sharepop').show().on('click',function(){
			$('.bgblack,.sharepop').hide()
		});
		}else{
		$('#sharepopya').show();
	}
	
}

var myAudio=document.getElementById('music'), playing = true;
$(".musicIcon").click(function(){
 	playing = !playing;
    if (playing == false) {
        myAudio.pause();
		$(this).addClass('close')
    }
    else {
        myAudio.play();
		$(this).removeClass('close')
    }
})

$('.btnrecord').bind('contextmenu', function(e) {
		e.preventDefault();
	})
	
if(isWx){
	var myAudio=document.getElementById('music')
document.addEventListener('DOMContentLoaded', function () {
	function audioAutoPlay() {
		myAudio.play();
		document.addEventListener("WeixinJSBridgeReady", function () {
			myAudio.play();
		}, false);
	}
	audioAutoPlay();
});
	}
</script>
<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?605e06093f1ca31a337515854f9ce37b";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>
</body>
</html>
